<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>GPS_Obliczenia-VMG_ver_11</title>
	<style>
      button {
	          background-color: lightgrey;
	          float: left;
			  width: 200px;
			  height:200px;
			  font-size: 60px;
			  margin-right: 10px;  //odległość tekstu od prawej strony przycisku
			  }
	  
	  body {
	        color: white;
	        background-color: black;
	        margin-top: 20px;
			margin-left: 10px;
	        margin-right: 10px;


	       }
      input {
	        color: red;
			font-size: 60px;
			width: 150px;
			float: left;
			margin-right: 20px;
	        }
		h1 {
		     font-size:60px;
		   }
		h2 {
			 font-size:50px;
		    float: left;
		   }
		h3 {
     		font-size:70px;
		   }
		 p { font-size:25px;  }
		

	</style>
	<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
</head>
<body>
	
    <p><button onclick="Start()"> Start </button></p>
	<h1>Kurs  Minuty</h1>
	<input id="Kurss"> </input>
	<input id="Interwal"> </input>
	<h1> min.</h1>

	<h2 id="latOld2">50.70123</h2>
	<h2>___</h2>
    <h2 id="lonOld2">21.75419<br></h2>
	<p id="No">1<br></p>
	<h1><br></h1>

	 <h3 id="DlugoscSzerokosc"></h3>
     
	 
	 <h3><br></h3>
	 
	 <p>Instrukcja: <br>
	 Podaj kurs (w stopniach) w jakim chciał byś płynąć, oraz odstęp czasowy (w minutach) co ile chcesz otrzymywać dane. Dla regat polecam od 0.5 do 1 minuty, na morzu polecam od 1 do 5 minut. 
	 Kurs podawaj zawsze dodatni od 0 do 365 stopni. Minuty możesz podać mniej niż jedną, ale z kropką dziesiętną, nie przecinkiem np. [0.1] oznacza, że dane będą się pojawiać co 6 sekund. 
	 Musisz mieć włączoną "lokalizację" w telefonie oraz po przyciśnięciu "Start" musisz zaakceptować pozwolenie na "Dostęp do lokalizacji".
	 Apka korzysta z danych lokalizacji urządzenia, jeżeli masz w telefonie włączoną lokalizację GPS to takie dane będziesz otrzymywał, a jeżeli masz włączoną tylko lokalizację GSM to dane będą niedokładne.
     Włącz dźwięk w telefonie, na koniec każdego odcinka usłyszysz "beep". 
	 Pierwszy odcinek zaczyna się liczyć od momentu naciśnięcia przycisku "Start". Najnowsze dane wyświetlają się na górze listy.<br><br>
	 
	 W pierwszej kolumnie [BRG] "Bearing" wyświetlany jest kurs w stopniach. <br>
	 W drugiej kolumnie [SOG] "Speed Over Ground" wyświetlana jest prędkość nad dnem, w węzłach [kn], inaczej, w [mile morskie / godzinę] lub [1852m / godzinę].<br> 
	 W ostatniej kolumnie [VMG] "Velocity Made Good" wyświetlana jest kluczowa informacja, czyli prędkość rzutowana na zadany kierunek. <br><br> 
	 Pierwszy wariant pracy z apką to trzymanie stałego kierunku i praca z żaglami. Po każdym sygnale zmieniasz ustawienie żagli i sprawdzasz jak zmieniła się prędkość.<br>
	 Drugi wariant, to szukanie optymalnego kursu. Ustawiasz się najostrzej do wiatru jak to możliwe i po każdym sygnale odpadasz o kilka stopni. Porównujesz na którym odcinku prędkość VMG była największa.<br> 
	 Bo czasami warto odpaść i zwiększyć prędkość, ale pytenie jak bardzo opłaca się odpadać? Zależy to od kierunku i siły wiatru, ta apka pozwala to w prosty sposób sprawdzić.</p>
 
 	 

	<script>
	
	function Dynamic()
	{
	 var Kurss = document.getElementById("Kurss").value;
     document.getElementById("DlugoscSzerokosc").innerHTML = "Kurs " + Kurss + "<br>" + document.getElementById("DlugoscSzerokosc").innerHTML;

	}
	
	
	let audioContext = new (window.AudioContext || window.webkitAudioContext)();

//    function Bearr(){
//	var Bearing = 190;
//	let BearingText = Bearing.toString();
//	let Dlugosc = BearingText.length;
//	if(Dlugosc == 1) {BearingText = "00" + BearingText;}
//	if(Dlugosc == 2) {BearingText = "0" + BearingText;}	
//
//	document.getElementById("DlugoscSzerokosc").innerHTML += BearingText;
//	}

    function Dzwiek()
	{ const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.type = "sine";
      oscillator.frequency.value = 100;

      const now = audioContext.currentTime;
      gainNode.gain.setValueAtTime(20, now);
      gainNode.gain.exponentialRampToValueAtTime(0.11, now + 1);
      oscillator.start(now);
      oscillator.stop(now + 1);
	}

	
function Start()
{

     var Interwal = document.getElementById("Interwal").value*60000;
     var Licznik = Interwal;
  
	function petla() 
	   {

	   if (Licznik >= Interwal)
	      {
			navigator.geolocation.getCurrentPosition(function(location) 
			{
             var lat = location.coords.latitude;
			 var lon = location.coords.longitude;
			 let latOld = document.getElementById("latOld2").textContent;
			 let lonOld = document.getElementById("lonOld2").textContent;
			 let No = document.getElementById("No").textContent;
			 No = No *1;
			 latOld = latOld * 1;
			 lonOld = lonOld *1;
			 var Interwal = document.getElementById("Interwal").value*60000;
			 var Kurss = document.getElementById("Kurss").value;
			 
			 var theta = lon - lonOld;
			 var Dystans = 60 * (180/Math.PI) * Math.acos(Math.sin(lat * (Math.PI/180)) * Math.sin(latOld * (Math.PI/180)) + Math.cos(lat * (Math.PI/180)) * Math.cos(latOld * (Math.PI/180)) * Math.cos(theta * (Math.PI/180))); 
			 var Dystans2 = Dystans.toFixed(3);
			 
			 var Predkosc = ((Dystans * 3600144) / Interwal).toFixed(2);
			 
			 var BearingY = Math.sin(lon * (Math.PI/180) - lonOld * (Math.PI/180)) * Math.cos(lat * (Math.PI/180));
			 var BearingX = Math.cos(latOld * (Math.PI/180)) * Math.sin(lat * (Math.PI/180)) - Math.sin(latOld * (Math.PI/180)) * Math.cos(lat * (Math.PI/180)) * Math.cos(lon * (Math.PI/180) - lonOld * (Math.PI/180))
			 var Bearing = Math.atan2(BearingY, BearingX);
			 Bearing = Bearing * 180 / Math.PI;
			 Bearing = Math.round((Bearing + 360) % 360);
			 let BearingText = Bearing.toString();
	         let Dlugosc = BearingText.length;
	             if(Dlugosc == 1) {BearingText = "00" + BearingText;}
	             if(Dlugosc == 2) {BearingText = "0" + BearingText;}	
			 			 
			 var DystansMG = Dystans * Math.cos(Kurss * (Math.PI/180) - Bearing * (Math.PI/180));
			 var DystansMG2 = DystansMG.toFixed(3);
			 
			 var VMG = ((DystansMG * 3600144) / Interwal).toFixed(2); 
			 
			 if(No == 1) { document.getElementById("DlugoscSzerokosc").innerHTML = "BRG_SOG_VMG<br>";}
			 else        { document.getElementById("DlugoscSzerokosc").innerHTML = BearingText + "___" + Predkosc + "__" + VMG + "<br>" + document.getElementById("DlugoscSzerokosc").innerHTML;}
				  
             document.getElementById("No").innerHTML = No + 1;			   
			 document.getElementById("latOld2").innerHTML = lat;
			 document.getElementById("lonOld2").innerHTML = lon;
			 
			 Dzwiek();
			 
			});
			Licznik = 0;
		  }
		 
		  
		  Licznik = Licznik + 100;
       }	 
	 setInterval(petla, 100);
	 
}

	</script>
</body>
</html>